<html>
<head>
<style>
  body {
    text-align: center;
    font-family: sans-serif;
  }
  canvas {
    background-color: lightgrey;
  }
</style>
</head>
<body>
<script>
function GeographicLocation(name, capital, path, color, attackX, attackY) {
 this.name = name;
 this.capital = capital;
 this.path = path;
 this.color = color;
 this.attackX = attackX;
 this.attackY = attackY;
}

function Threat(name, imgID) {
 this.name = name;
 this.imgID = imgID;
}

var states = [
 new GeographicLocation("Utah", "", "m 488.53127,414.01361 -2.106,10.382 -13.34,-2.946 -17.506,-3.976 -18.444,-4.44 -20.22,-5.146 -19.052,-5.05 -15.588,-4.352 3.276,-12.764 6.508,-24.788 6.084,-22.588 6.506,-23.804 7.254,-26.05 6.976,-24.552 12.172,3.74 17.598,5.146 18.678,5.236 9.128,2.434 -6.648,26.844 18.958,4.818 20.41,4.908 -5.384,24.6 -5.616,26.05 -5.008,23.756 z", "#FFFFFF", 443, 353),
 new GeographicLocation("Colorado", "", "m 503.79127,341.67361 5.382,-24.598 12.546,2.854 18.21,3.974 19.238,3.928 17.6,3.368 16.71,3.04 15.728,2.62 20.316,3.274 19.846,2.946 -3.556,25.814 -3.324,24.506 -3.418,25.908 -3.088,23.712 -0.89,6.828 -20.876,-2.806 -23.312,-3.556 -17.694,-2.804 -18.724,-3.132 -20.456,-3.696 -26.024,-5.05 -21.58,-4.398 2.106,-10.382 4.634,-22.542 5.01,-23.758 z", "#FFFFFF", 567, 384),
 new GeographicLocation("Wyoming", "", "m 476.45127,280.49361 -6.648,26.844 18.958,4.818 20.41,4.908 12.546,2.854 18.208,3.974 19.238,3.93 17.6,3.368 16.71,3.038 15.73,2.62 4.398,-26.986 4.45,-26.562 4.632,-27.032 4.54,-26.19 -16.756,-3.086 -18.07,-3.554 -17.038,-3.6 -15.54,-3.416 -16.336,-3.834 -17.882,-4.444 -16.852,-4.442 -11.656,-3.18 -3.556,13.47 -8.238,31.66 z", "#FFFFFF", 548, 269),
 new GeographicLocation("Washington", "", "m 287.10727,69.257611 0.702,1.776 -1.498,3.554 0.936,0.704 0.842,-0.892 1.264,-3.788 1.404,-2.431996 v -0.84 l -1.264,-0.33 -0.844,-0.934 -0.092,-1.17 0.936,-2.338 1.874,-1.262 1.356,-1.682 -0.376,-2.106 -2.292,1.31 -0.234,-0.562 0.796,-4.818 2.902,-11.504 0.468,-6.128 -0.936,-4.488 V 28.14761 l 0.608,-2.666 1.592,-2.994 2.246,-2.38599 1.968,-0.978 2.198,3.54999 7.022,7.812005 2.714,1.404 3.232,2.758 4.26,1.778 3.134,4.02 3.558,1.17 -0.234,2.992 -1.732,2.62 -0.888,0.656 -1.874,0.186 -1.262,0.654 -5.62,5.148 -1.496,3.834 2.294,0.934 1.262,-1.872 -0.7,-0.748 1.498,-1.168 3.79,-1.078 4.542,-3.552 1.964,0.14 0.61,0.608 0.048,2.712 0.278,0.234 2.436,-4.068 2.152,-4.912 0.796,-5.888 v -1.22 l -1.076,-1.494 -0.938,-2.482 0.142,-0.42 h 1.45 l 2.154,-1.308 1.404,-2.9 1.124,0.046 0.796,1.312 0.516,-0.236 -0.376,-1.778005 -2.06,-2.058 -2.154,-1.028 -0.56,-2.944 0.094,-3.13599 18.254,9.07399 14.698,6.966005 15.636,7.11 14.37,6.314 13.668,5.754 15.588,6.358 -12.216,33.485996 -11.704,32.783999 -1.076,1.774 0.42,6.174 -1.732,1.638 0.656,2.946 -36.746,-14.498 -2.198,0.654 -8.614,-3.04 -2.154,1.078 -5.196,-1.312 -5.664,0.47 -4.586,-1.124 -2.108,-2.384 -10.626,-0.516 -1.638,-3.788 -8.424,-4.066 -4.12,0.84 -5.758,-0.748 -6.834,-6.128 2.342,-8.743999 -0.096,-3.088 -3.464,-5.752 -1.404,-2.244 -1.028,-2.946 -6.694,-3.086 -1.406,-2.852 0.656,-2.714 z", "#FFFFFF", 348, 72),
 new GeographicLocation("Montana", "", "m 453.85127,193.79361 -1.358,-2.526 -0.282,-2.15 1.078,-0.656 0.468,-1.402 -0.328,-3.04 -1.078,-0.468 -0.09,-2.478 -1.312,-3.368 0.654,-1.916 -0.514,-1.638 0.796,-1.778 -0.844,-0.934 0.796,-1.964 -2.62,-3.694 -0.564,1.26 -2.574,1.452 -2.34,0.186 -2.06,1.17 -1.872,-3.04 -1.684,-0.748 2.2,-3.462 -0.562,-2.198 3.978,-1.918 -0.232,-1.214 0.7,-1.496 -1.17,-0.796 1.358,-2.666 -0.514,-1.684 1.496,-0.326 0.234,-2.246 3.042,-4.35 -0.046,-1.59 1.358,-0.374 1.264,-3.46 -4.586,-0.794 -0.796,-1.216 0.702,-1.03 -0.61,-1.17 -1.966,0.374 0.516,-1.59 -1.874,-2.618 0.516,-2.246 -1.686,-2.478 -2.386,-8.698 -2.668,-2.244 -0.656,-2.76 -2.06,-2.246 2.014,-0.7 -1.124,-2.526 1.544,-1.028 0.096,-2.9 -2.95,-9.539999 8.94,-25.721996 33.142,12.017996 21.25,7.108 15.448,4.864 16.382,4.958 15.26,4.397999 10.206,2.804 16.522,4.348 15.12,3.744 14.368,3.366 15.778,3.508 16.756,3.46 13.95,2.946 -4.54,24.32 -4.728,25.768 -4.214,23.476 -1.216,6.782 -4.448,25.066 -16.756,-3.086 -18.07,-3.554 -17.038,-3.6 -15.54,-3.416 -16.336,-3.834 -17.882,-4.444 -16.852,-4.442 -11.656,-3.18 -3.556,13.47 -2.154,-3.228 -0.842,-4.442 -0.936,-0.982 -2.2,0.748 v 1.262 l -1.546,1.308 0.374,1.826 -3.602,-1.638 -2.714,0.374 -1.078,-1.402 -4.026,-0.328 -2.668,-1.824 -1.872,0.468 -1.544,1.824 -5.102,-2.992 -1.546,0.092 -1.78,1.122 0.048,1.356 -0.562,0.282 -2.388,-3.368 0.61,-2.01 -0.89,-2.198 0.89,-1.216 -0.796,-3.834 -1.546,-1.638 z", "#FFFFFF", 531, 145),
 new GeographicLocation("California", "", "m 215.86327,310.67361 2.058,1.264 0.234,1.402 1.078,0.982 1.592,-0.56 0.608,-0.704 2.246,-5.516 4.916,2.386 3.932,3.74 -3.042,0.608 -2.436,-0.422 -2.574,1.59 -0.374,2.62 1.216,8.418 -0.466,2.29 -2.202,-3.88 -1.03,-3.508 v -2.478 l -1.404,-1.028 -1.592,2.804 -0.606,2.854 0.374,5.33 -1.266,8.184 2.014,5.1 4.354,2.896 0.796,4.678 -1.5,4.724 -3.228,1.264 -1.452,5.332 0.234,1.962 4.962,12.908 2.012,9.398 3.746,8.512 1.872,2.152 -1.122,4.676 2.478,2.902 1.078,3.598 -0.048,1.076 -1.684,2.576 -0.936,3.646 -0.796,6.22 0.374,1.916 2.248,2.012 6.788,3.79 3.836,4.3 2.2,-0.56 2.388,1.308 2.994,3.552 3.092,2.622 0.89,3.18 5.29,4.63 1.824,2.15 0.936,2.106 1.92,-2.106 1.73,0.47 1.312,1.402 2.248,4.068 -0.422,4.584 0.28,0.934 5.196,2.34 3.698,4.348 2.34,3.602 3.606,8.416 2.526,4.492 1.216,4.724 -1.638,11.316 0.048,3.32 50.368,9.776 2.574,-2.104 3.228,1.262 2.67,-3.32 0.514,-2.9 -4.306,-4.538 1.45,-3.368 -0.748,-2.71 0.656,-2.806 2.104,0.094 3.326,-3.228 0.888,-3.366 1.124,-0.794 0.842,-6.736 2.434,-1.214 1.312,-2.106 6.928,-3.042 -1.218,-5.658 -2.576,-2.992 -2.948,-10.944 0.656,-3.04 -15.12,-26.142 -11.984,-20.718 -11,-19.782 -9.686,-18.146 -9.972,-19.36 -10.578,-21.326 -9.598,-20.39 9.316,-27.172 8.846,-25.256 10.064,-28.012 -17.648,-7.388 -17.882,-7.81 -22.654,-10.382 -17.366,-8.326 -0.608,4.068 -2.528,13.47 -4.492,7.764 -3.184,7.482 -3.654,3.226 -3.882,2.292 -1.452,3.226 -0.516,2.104 1.406,3.228 2.668,18.94 -0.282,2.246 -1.498,1.87 -1.778,4.35 -2.2,15.48 1.31,3.834 1.124,5.426 3.698,9.822 0.046,3.458 -1.312,3.322 0.282,1.822 z", "#FFFFFF", 254, 353),
 new GeographicLocation("Idaho", "", "m 455.67127,193.56161 -1.824,0.234 -1.358,-2.526 -0.282,-2.15 1.078,-0.656 0.468,-1.402 -0.328,-3.04 -1.078,-0.466 -0.092,-2.48 -1.31,-3.368 0.654,-1.916 -0.516,-1.638 0.798,-1.778 -0.844,-0.934 0.796,-1.964 -2.622,-3.694 -0.562,1.262 -2.574,1.45 -2.34,0.186 -2.06,1.17 -1.872,-3.04 -1.684,-0.748 2.2,-3.462 -0.564,-2.198 3.98,-1.918 -0.234,-1.214 0.702,-1.496 -1.17,-0.796 1.358,-2.666 -0.516,-1.682 1.498,-0.328 0.234,-2.246 3.042,-4.35 -0.046,-1.59 1.358,-0.374 1.264,-3.46 -4.586,-0.794 -0.798,-1.216 0.704,-1.03 -0.61,-1.17 -1.966,0.374 0.516,-1.59 -1.874,-2.618 0.516,-2.246 -1.686,-2.478 -2.388,-8.698 -2.668,-2.244 -0.654,-2.76 -2.06,-2.246 2.014,-0.7 -1.124,-2.526 1.544,-1.028 0.096,-2.9 -2.952,-9.539999 8.942,-25.721996 -16.008,-6.174 -12.218,33.485996 -11.704,32.781999 -1.074,1.778 0.42,6.174 -1.734,1.636 0.658,2.946 0.702,5.378 3.088,3.18 0.234,4.724 -5.756,5.332 -2.762,4.49 -3.56,2.992 -0.886,2.666 -1.922,2.104 -3.134,1.358 -5.71,5.75 -1.312,5.24 3.51,1.964 0.844,3.086 -2.202,1.638 0.048,2.292 -3.23,4.394 -16.102,48.686 12.03,4.254 17.366,5.986 18.49,5.938 8.612,2.714 12.172,3.74 17.598,5.146 18.678,5.236 9.128,2.434 8.848,-34.842 8.238,-31.66 -2.154,-3.228 -0.844,-4.442 -0.934,-0.982 -2.2,0.748 v 1.262 l -1.546,1.31 0.374,1.824 -3.602,-1.638 -2.716,0.374 -1.078,-1.402 -4.024,-0.328 -2.668,-1.824 -1.872,0.468 -1.544,1.826 -5.104,-2.994 -1.544,0.092 -1.78,1.122 0.048,1.358 -0.562,0.28 -2.388,-3.366 0.61,-2.012 -0.89,-2.198 0.89,-1.216 -0.798,-3.834 z", "#FFFFFF", 415, 210),
 new GeographicLocation("Oregon", "", "m 298.20327,96.473611 -2.342,8.743999 6.834,6.126 5.758,0.748 4.12,-0.84 8.424,4.07 1.64,3.788 10.624,0.514 2.108,2.384 4.586,1.124 5.664,-0.468 5.196,1.308 2.154,-1.076 8.614,3.042 2.198,-0.654 36.746,14.498 0.702,5.378 3.088,3.178 0.236,4.724 -5.758,5.33 -2.762,4.492 -3.558,2.992 -0.888,2.666 -1.92,2.104 -3.136,1.358 -5.71,5.75 -1.312,5.24 3.51,1.964 0.844,3.086 -2.202,1.636 0.048,2.292 -3.23,4.398 -16.102,48.682 -8.754,-3.178 -18.254,-6.828 -17.134,-6.688 -11.842,-4.818 -17.648,-7.388 -17.882,-7.81 -22.654,-10.382 -17.366,-8.326 0.28,-1.778 0.47,-8.418 3.228,-9.446 1.36,-5.846 5.71,-8.652 3.23,-2.664 2.714,-0.468 0.75,-2.854 -0.562,-0.282 0.186,-0.512 1.498,-2.712 5.57,-7.764 2.106,-4.442 2.248,-2.902 6.226,-14.918 3.136,-3.786 5.102,-10.664 2.434,-2.337999 1.312,-3.884 1.498,-1.68 -0.564,-1.498 0.75,-2.338 2.714,-5.004 1.124,-1.452 1.358,-0.326 6.226,2.432 2.902,2.992 0.794,-0.796 3.464,5.752 z", "#FFFFFF", 307, 158),
 new GeographicLocation("Nevada", "", "m 359.85127,429.39361 -0.422,11.32 -1.124,5.096 -1.404,0.284 -0.796,3.74 -15.12,-26.142 -11.984,-20.718 -11,-19.782 -9.686,-18.146 -9.972,-19.36 -10.578,-21.326 -9.598,-20.39 9.316,-27.172 8.846,-25.256 10.064,-28.012 11.842,4.818 17.134,6.688 18.254,6.826 8.752,3.18 12.032,4.256 17.366,5.986 18.492,5.94 8.61,2.712 -6.974,24.552 -7.254,26.05 -6.508,23.804 -6.084,22.59 -6.508,24.784 -3.276,12.768 -5.618,22.028 -2.528,3.366 -1.356,0.514 -1.732,-0.748 -1.312,-3.508 -2.058,-0.138 -1.874,-1.452 -3.602,2.526 -1.546,1.966 0.888,2.43 z", "#FFFFFF", 341, 305),
 new GeographicLocation("Hawaii", "", [
  "m 127.62205,439.26433 2.852,-4.282 6.38,-3.734 10.136,-3.18 1.49,-3.366 -7.136,-5.12 -0.252,-3.612 -2.726,-2.892 -16.198,-7.262 -1.594,1.134 0.376,3.104 1.47,2.77 -5.96,5.962 1.678,3.272 2.604,7.052 0.168,7.97 z",
  "m 105.46205,392.38433 1.468,5.292 h 3.108 l 4.402,-1.302 3.354,-1.588 -0.33,-2.484 -6.712,-3.61 -5.206,1.05 -3.232,-3.944 -0.964,0.462 -1.634001,2.808 1.802001,2.604 z",
  "m 97.082049,391.68433 -1.092,1.512 -2.978,0.588 -0.462,-2.186 -1.806,-1.382 -0.044,-0.756 3.612,-0.38 z",
  "m 98.302049,385.40433 1.37,-2.288 -13.978,-1.634 -1.38,3.102 1.302,0.29 4.742,-0.5 5.58,1.51 z",
  "m 70.642049,374.04433 -3.27,-4.662 -3.82,2.772 -3.988,0.168 4.66,7.302 5.162,-0.334 3.27,0.922 2.438,-1.342 z",
  "m 25.742049,356.38433 -3.654,2.388 -0.626,2.858 5.582,2.768 3.444,-0.086 2.136,-1.758 0.464,-4.87 -2.35,-2.098 z",
  "m 13.062049,360.70433 0.922,0.712 -3.65,5.75 -1.1740003,-0.67 z"
 ], "#FFFFFF", 130, 417),
 new GeographicLocation("Alaska", "", "m 33.534209,144.95593 -7.602,1.4 -3,3.2 3,1.4 15,-6 9,-4.6 18,-12 13.602,-14.8 1.398,-3.2 h -4.598 l 13.598,-19.399999 3,-1.4 v 2.8 l -4.598,3.2 -1.402,8.799999 3,-1.4 -3,3 1.402,1.6 9.2,-6 4.398001,-1.599999 1.602,-4.4 -1.602,-3.2 9,-1.4 10.602,6 8.8,-3 4.598,1.6 h 6 l 16.602,7.399999 2.8,3 4.598,6 9,6 3,3 10.602,6 10.398,-4.6 v -6 l -3,-6 -4.598,-1.4 h -4.402 l -6,-4.6 -6,-4.399999 -12,-12 -3,1.6 -3,4.4 -3,3 -10.598,-6 v -3 l -8.8,3 -3.2,-15 -7.402,-33.000008 -6,-22.600003 -3,-10.3999995 -9,-4.4 -4.598,2.8 -14.800001,-2.8 -4.602,1.4 -4.598,-1.4 v -1.6 l -13.402,-3.00000001 -1.398,3.00000001 h -7.602 l -6,4.4 -4.398,4.5999995 -1.602,4.6 -3,2.8 h -6 l -3,4.6 4.402,4.600003 4.598,7.4 6,1.4 v 9.2 h -7.398 v -6 h -1.602 l -15,6 4.602,4.4 v 6 l 6,3 8.8,1.4 6,-4.4 1.598,10.4 -6,1.600008 -1.598,3 -2.8,1.4 -4.602,-2.8 -3,6 -7.598,7.4 4.598,7.4 -1.398,3.2 6,5.999999 h 7.398 l 3,4.4 -1.598,3 1.598,4.6 6,-3.2 6,6 9,-4.4 -3,6 v 6 l -12,9 -4.398,6 h -4.602 z", "#FFFFFF", 81, 47)
];

var challenges = [
 new Threat("Aliens", "alien")
];

var currentState = 0;
var currentChallenge = 0;
var names = [];
</script>
<canvas id="world" width="800" height="800"></canvas>
<div style="display:none;">
<img id="alien" src="alien.png" />
</div>
<script>
 var canvas = document.getElementById('world');
 var ctx = canvas.getContext('2d');

 function mousedown_handler(e)
 {
  var parentPosition = getPosition(e.currentTarget);
  var xPos = e.clientX - parentPosition.x;
  var yPos = e.clientY - parentPosition.y;
  var width = Math.floor(canvas.width / 3);
  if ((xPos % width) < 5)
   return;
  row = Math.floor(xPos / width);
  if ((yPos < 590) || ((yPos - 590) % 50 >= 40))
   return;
  var col = Math.floor((yPos - 590) / 50);
  var choice = col * 3 + row;
  if (choice < names.length)
  {
   if (names[choice] == states[currentState].name)
   {
    states[currentState].color = "#00FF00";
   }
   else
   {
    states[currentState].color = "#000000";
   }
   currentState = findState();
   if (currentState != -1)
    states[currentState].color = "#FF0000";
   mainDraw();
  }
 }

// Helper function to get an element's exact position
function getPosition(el) {
  var xPos = 0;
  var yPos = 0;
 
  while (el) {
    if (el.tagName == "BODY") {
      // deal with browser quirks with body/window/document and page scroll
      var xScroll = el.scrollLeft || document.documentElement.scrollLeft;
      var yScroll = el.scrollTop || document.documentElement.scrollTop;
 
      xPos += (el.offsetLeft - xScroll + el.clientLeft);
      yPos += (el.offsetTop - yScroll + el.clientTop);
    } else {
      // for all other non-BODY elements
      xPos += (el.offsetLeft - el.scrollLeft + el.clientLeft);
      yPos += (el.offsetTop - el.scrollTop + el.clientTop);
    }
 
    el = el.offsetParent;
  }
  return {
    x: xPos,
    y: yPos
  };
}

function findState()
{
 var i;
 var available = [];
 for (i = 0; i < states.length; i++)
 {
  if (states[i].color == "#FFFFFF")
  {
   available.push(i);
  }
 }
 if (available.length == 0)
  return -1;
 return available[Math.floor((Math.random() * 1000)) % available.length];
}

function mainDraw()
{
 ctx.clearRect(0, 0, canvas.width, canvas.height);
 ctx.strokeStyle = "#000000";
 states.forEach(function(state) {
  ctx.fillStyle = state.color;
  if (Array.isArray(state.path))
  {
   state.path.forEach(function(path1) {
    var p = new Path2D(path1);
    ctx.fill(p);
    ctx.stroke(p);
   });
  }
  else
  {
   var p = new Path2D(state.path);
   ctx.fill(p);
   ctx.stroke(p);
  }
 });
 var i;
 var width = Math.floor(canvas.width / 3);
 for (i = 0; i < names.length; i++)
 {
  var row = i % 3;
  var col = Math.floor(i / 3);
  ctx.fillStyle = "#FFFFFF";
  ctx.rect(5 + width * row, 590 + 50 * col, width - 5, 40);
  ctx.fill();
  ctx.stroke();
 }
 for (i = 0; i < names.length; i++)
 {
  var row = i % 3;
  var col = Math.floor(i / 3);
  ctx.font = "34px Arial";
  ctx.fillStyle = "#000000";
  ctx.textAlign = "center";
  ctx.fillText(names[i], Math.floor(width / 2) + width * row, 620 + 50 * col);
 }
 var img = document.getElementById(challenges[currentChallenge].imgID);
 if (currentState != -1)
  ctx.drawImage(img, states[currentState].attackX - Math.floor(img.width / 2), states[currentState].attackY - Math.floor(img.height / 2));
}
 states.forEach(function(state) {
  if (state.name != "")
   names.push(state.name);
 });

 canvas.onmousedown = mousedown_handler;
 window.onload = function() {
  currentState = findState();
  states[currentState].color = "#FF0000";
  currentChallenge = Math.floor((Math.random() * 1000)) % challenges.length;
  mainDraw();
 };
</script>
</body>
</html>
